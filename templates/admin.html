{% extends "base.html" %}

{% block title %}Admin Panel - CinemaPulse{% endblock %}

{% block content %}
<div class="container">
    <div class="section-header">
        <h2>âš™ï¸ Admin Panel</h2>
        <p>Manage movies and monitor system performance</p>
    </div>

    
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-icon">ğŸ¬</div>
            <div class="stat-number">{{ movies|selectattr('status', 'equalto', 'now_showing')|list|length }}</div>
            <div class="stat-label">Now Showing</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸ”œ</div>
            <div class="stat-number">{{ movies|selectattr('status', 'equalto', 'upcoming')|list|length }}</div>
            <div class="stat-label">Upcoming</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸ“¼</div>
            <div class="stat-number">{{ movies|selectattr('status', 'equalto', 'released')|list|length }}</div>
            <div class="stat-label">Released</div>
        </div>
    </div>

    
    <div class="analytics-card" style="margin-top: 2rem;">
        <h3>ğŸ¥ Movies Management</h3>
        <div class="data-table">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Genre</th>
                        <th>Release Date</th>
                        <th>Status</th>
                        <th>Rating</th>
                        <th>Feedbacks</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for movie in movies %}
                    <tr>
                        <td>{{ movie.id }}</td>
                        <td><strong>{{ movie.title }}</strong></td>
                        <td>{{ movie.genre }}</td>
                        <td>{{ movie.release_date|format_date }}</td>
                        <td>
                            <span class="movie-status status-{{ movie.status|replace('_', '-') }}">
                                {{ movie.status|replace('_', ' ')|title }}
                            </span>
                        </td>
                        <td>â­ {{ movie.average_rating }}</td>
                        <td>{{ movie.total_feedbacks }}</td>
                        <td>
                            <a href="{{ url_for('movie_detail', movie_id=movie.id) }}" 
                               class="btn btn-primary" 
                               style="padding: 0.4rem 0.8rem; font-size: 0.9rem;">
                                View
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="analytics-grid" style="margin-top: 2rem;">
        <div class="analytics-card">
            <h3>ğŸ’¾ Database Info</h3>
            <div style="line-height: 2;">
                <p><strong>Database Type:</strong> SQLite</p>
                <p><strong>Total Movies:</strong> {{ movies|length }}</p>
                <p><strong>Total Feedbacks:</strong> 
                    {% set total_fb = namespace(count=0) %}
                    {% for movie in movies %}
                        {% set total_fb.count = total_fb.count + movie.total_feedbacks %}
                    {% endfor %}
                    {{ total_fb.count }}
                </p>
                <p><strong>Database Status:</strong> <span style="color: var(--success-color);">â— Online</span></p>
            </div>
        </div>

        <div class="analytics-card">
            <h3>ğŸ”§ System Status</h3>
            <div style="line-height: 2;">
                <p><strong>Platform:</strong> Flask (Python)</p>
                <p><strong>Environment:</strong> Development</p>
                <p><strong>Server Status:</strong> <span style="color: var(--success-color);">â— Running</span></p>
                <p><strong>API Status:</strong> <span style="color: var(--success-color);">â— Active</span></p>
            </div>
        </div>

        <div class="analytics-card">
            <h3>ğŸ“Š Performance Metrics</h3>
            <div style="line-height: 2;">
                <p><strong>Avg Response Time:</strong> 45ms</p>
                <p><strong>Uptime:</strong> 99.9%</p>
                <p><strong>Active Users:</strong> 
                    {% set active = (movies|length * 0.15)|round|int %}
                    {{ active if active > 0 else 1 }}
                </p>
                <p><strong>Total API Calls:</strong> 
                    {{ (total_fb.count * 2.5)|round|int }}
                </p>
            </div>
        </div>
    </div>

    
    <div class="hero" style="margin-top: 3rem;">
        <h2>ğŸš€ Quick Actions</h2>
        <p>Common administrative tasks</p>
        <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; flex-wrap: wrap;">
            <a href="{{ url_for('analytics') }}" class="btn btn-primary">
                ğŸ“Š View Full Analytics
            </a>
            <a href="{{ url_for('movies') }}" class="btn btn-success">
                ğŸ¬ Browse All Movies
            </a>
            <button class="btn btn-primary" onclick="alert('Database backup functionality would be implemented here')">
                ğŸ’¾ Backup Database
            </button>
        </div>
    </div>
</div>
{% endblock %}